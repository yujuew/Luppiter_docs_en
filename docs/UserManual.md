# 展湾智慧通®工业物联网平台产品手册

## 1. 目的

本手册详细描述了展湾智慧通®工业物联网平台的产品架构、基础组件、模块主要功能及详细使用操作步骤。



## 2. 产品概述

展湾智慧通®工业物联网平台提供海量设备的接入和管理能力，提供设备上云、数据处理、规则引擎、运维监控、消息推送、视频服务和BI服务等多种功能，配合平台端其他产品及第三方应用，可以帮助用户简化海量设备管理复杂性，节省人工操作，提升管理、生产效率，加速工业4.0企业数字化转型。

展湾智慧通®工业物联网平台采用高性能的大数据组件架构、流式数据处理，实现采集数据的汇聚、存储、大数据分析及人工智能算法应用，满足工业场景下复杂的应用环境和海量的数据处理要求，提供高性能的数据处理、数据存储等服务。通过对数据的处理、分析、深度挖掘帮助工业企业提升生产效率和产品质量。

### 2.1 产品架构



![](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200714154610024.png)

### 2.2 功能模块

![产品架构](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200714153755480.png)

展湾智慧通®工业物联网平台实现了设备上云、数据处理、云边协同、消息推送、视频和BI的多种功能，支持海量设备连接上云，设备与云端之间实现稳定可靠的双向通信，设备的生命周期管理，数据的流转与可视化。确保了公有云平台具备了主流的设备接入能力、数据模型分析能力。

| 功能模块 | 功能简介                                                     |
| -------- | ------------------------------------------------------------ |
| 总体概览 | 平台/租户当前设备和运营情况的总体概览                        |
| 设备管理 | 多种形式设备接入，物模型、物影子部分                         |
| 规则引擎 | 制定规则，对数据进行处理和转发                               |
| 运维监控 | 可视化组态（2D/3D组态）、在线调试、远程配置、固件升级、日志查看 |
| 消息推送 | 基于HTTP和MQTT的消息订阅推送                                 |
| 视频服务 | 视频源接入、视频直播、视频存储、视频回放                     |
| BI服务   | BI报表和看板相关服务                                         |

### 2.3 使用环境

支持操作系统：

支持浏览器：

---



## 3. 使用前准备

### 3.1 大数据模块简介

展湾智慧通®工业物联网平台提供包含 IoTDB、Redis、InfluxDB 、MySQL在内的多种数据库存储方案。

#### 3.1.1 实时数据存储Redis

内存数据库Redis中数据的读取和操作都在内存当中操作，读写的效率较高。

展湾智慧通®工业物联网平台中，Redis用于放实时监控、告警等数据，此类数据需要频繁访问，并且在短时间之内不会发生变化。将此类实时数据放入Redis中进行操作，可以提高应用的请求响应速度，降低数据库的读写次数，降低平台的负载。对于平台常用的实时计算统计功能，需要实时变化和展示，有较高的实时性需求。把相关数据放在Redis中进行操作，可以大大提高读取效率，进而提升平台整体性能。

#### 3.1.2 时序数据库InfluxDB

InfluxDB是在IoT和监控领域常见的一个时间序列数据库，具有高效的时间序列数据写入性能。

展湾智慧通®工业物联网平台中，InfluxDB用于存放工业物联网产生的海量历史数据，为数据统计分析和人工智能算法等深度数据挖掘提供数据源。其主要用途为监控系统；譬如收集大规模集群（包括网络设备、操作系统、应用程序）的监控数据并进行存储，查询。

#### 3.1.3 时序数据库IoTDB

IoTDB 是一个集成数据、专为时间序列数据设计的集成数据管理引擎，可提供数据收集，存储和分析服务。IoTDB结构轻巧，功能实用，性能优良，且与Hadoop、Spark、Flink生态紧密集成，可满足工业物联网领域中海量数据存储，高速数据提取和复杂数据分析的需求。

展湾智慧通®工业物联网平台中，IoTDB用于存放工业物联网产生的海量历史数据，为数据统计分析和人工智能算法等深度数据挖掘提供数据源。其主要用途为监控系统；譬如收集大规模集群（包括网络设备、操作系统、应用程序）的监控数据并进行存储，查询。

#### 3.1.4 分析关系数据库MySQL

关系数据库 MySQL 的体积小，运行速度快，命令执行的速度快。可移植性强，MySQL能够运行与多种系统平台上，如windouws，Linux，Unix等。MySQL复杂程度较低，易于使用。

展湾智慧通®工业物联网平台中，MySQL用于存储各种设备定义、业务逻辑、设备状态判定规则数据。

#### 3.1.5 流式分析Flink

面向数据流处理和批量数据处理的可分布式计算框架主要是对采集数据进行分流处理、数据清洗、数据解析，并将处理后的数据发送至高速消息队列，进而存储进不同的数据库中。规则引擎主要进行消息服务器的共享订阅、数据分流处理和过滤、统一字段名称、解析协议等数据处理工作。

Flink组件管理工具提供当前任务视图的呈现和调度的分布、当前各任务的执行情况、任务的提交和销毁等操作。

---



### 3.2 使用流程



## 4. 产品功能

### 4.1 总体概览

登录展湾智慧通®工业物联网平台控制台，可以查看当前的资源概览（产品、设备、数据规则、视频资源）、及设备按地理位置的分布概览、功能属性分布总图等。

用户也可以通过总体概览页面，根据页面指导按步骤接入物联网设备，快速开始使用展湾智慧通®工业物联网平台。

右上角可以选择语言，当前支持中英双语。

![image-20210208101016366](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208101016366.png)

---



### 4.3 设备管理

展湾智慧通®工业物联网平台提供海量设备的接入和管理能力。在物联网平台中，**产品 **通常指某一类具有相同功能定义或特征的设备的合集。**设备 **指归属于某一产品下的设备物理实体。例如：产品指某一个型号的产品，设备是该型号下的某个设备。

展湾智慧通®工业物联网平台支持对产品及设备的单个和批量管理，简化管理流程，降低配置安装复杂度，节省人工成本，提升管理效率。用户可以通过在控制台手动配置或一键导入模板，完成对产品的创建、定义、发布，设备的注册、管理、事件上报、服务调用等。设备接入控制台后，可以创建规则引擎、进行2D/3D组态、实施运维监控、订阅消息推送、数据生成BI报表等功能，方便用户监控设备的各种状态，利用接入设备的采集数据创造更多价值。

#### 4.3.1 产品

产品(product)即设备模型，指某一类具有相同功能定义或特征的设备的合集。在展湾智慧通®工业物联网平台中，设备直接接入或通过网关接入物联网平台，使用MQTT协议与平台进行高效可靠的通信，平台与设备边缘层间基于Topic进行通信，产品Topic分为基础通信Topic、物模型Topic和自定义Topic。产品的功能定义包括属性(properties)、事件(events)、服务(services)定义。作为产品的实体，该产品下的设备自动继承该产品定义的Topic和功能。

产品及产品属性、事件、服务定义，以及租户与产品的关联存储在MySQL数据库。

![image-20210208101253135](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208101253135.png)



##### 4.3.1.1 创建产品

要使用展湾智慧通®工业物联网平台，第一步需要在控制台创建产品。您可以通过 **标准创建**  选择平台已有标准模板快速创建产品，也可以使用 **导入模板** 导入本地 **.CSV** 格式的产品模板，您也可以跟随以下步骤进行产品 **自定义创建**。

**操作步骤：**

1、访问 **设备管理 > 产品** ；

2、单击 **自定义创建**  按钮，进入创建产品页面，按页面提醒填写必要的产品信息。

3、单击 **保存**，创建一个产品。

![image-20210208101319357](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208101319357.png)

页面参数详情如下：

| 参数项   | 参数详情                                                     |
| -------- | ------------------------------------------------------------ |
| 产品名称 | 产品的名称                                                   |
| 所属品类 | 根据实际情况选择产品所属的行业品类，内置选项包含：智能城市、智能生活、智能工业、边缘计算、商业共享、智能模块、智能电力、智能农业、智慧建筑、智能园区 |
| 节点类型 | 直连设备：指直接接入平台的设备<br />网关设备：指接入平台的网关设备<br />网关子设备：指通过网关间接接入平台的子设备 |
| 联网方式 | Wi-Fi：<br />蜂窝（2G/3G/4G/5G）：<br />以太网：<br />LoRaWAN：<br />其他：暂未支持 |
| 认证方式 | 当前支持设备秘钥方式                                         |
| 产品描述 | 非必填项，用户可输入其他自定义产品描述信息                   |

创建产品后，可点击 **查看** 操作查看产品详情。产品详情页包含标识符、设备总数、激活设备、当前设备等基本信息，其中，**标识符** 为平台自动生产的唯一的产品ID。您也可以查看产品信息、Topic类列表、功能定义等相关信息并对开发完成的产品进行发布。

发布后的设备不允许再进行编辑。如需编辑，请撤销发布。

![image-20210208101847440](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208101847440.png)



##### 4.3.1.2 产品Topic类

设备边缘层采用MQTT协议接入展湾智慧通®工业物联网平台，MQTT协议是一种基于Topic的发布/订阅（Publish/Subscribe）的常见物联网通信协议。在展湾智慧通®工业物联网平台中，对于产品Topic分为基础通信Topic、物模型通信Topic和自定义Topic。其中，基础通信Topic和物模型Topic由平台默认定义，无需用户创建。当产品需要使用自定义Topic进行通信时，用户可以创建自定义Topic。

产品Topic类不用于定义，仅用于定义该产品下的所有设备的Topic。产品下的设备自动继承该产品的基础通信Topic和物模型Topic。产品自定义Topic将自动映射到该产品下的所有设备中。



###### 基础通信Topic

基础通信Topic包含固件升级(OTA/)、时钟同步(NTP/)、配置查询(CFG/)、日志查看(LOG/)、心跳上报(HBT/)等通讯功能点相关的Topic。

**查看基础通信Topic的步骤：**

1、访问 **设备管理 > 产品** ，在产品列表操作栏中点击进入 **产品详情** 。

2、选择 **Topic类列表 > 基础通信Topic** ，即可查看基础通信Topic列表，列表包含各topic的操作权限（发布、订阅）和功能描述。

![image-20210208143045845](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143045845.png)



###### 物模型通信Topic

物模型通信Topic包含物影子、属性上报/设置、事件上报、响应服务调用功能点的相关Topic。

**查看物模型Topic的步骤：**

1、访问 **设备管理 > 产品** ，在产品列表操作栏中点击进入 **产品详情** 。

2、选择 **Topic类列表 > 物模型通信Topic** ，即可查看物模型Topic列表，列表包含各topic的操作权限（发布、订阅）和功能描述。



###### 自定义Topic

**创建自定义Topic的步骤：**

1、访问 **设备管理 > 产品** ，在产品列表操作栏中点击进入 **产品详情** 。

2、选择 **Topic类列表 > 自定义Topic** 查看自定义Topic列表。

3、点击 **定义Topic类** ，填写必要自定义Topic类相关信息（参数详情见下）。

3、单击 **确认** 即可创建自定义Topic类。 

![image-20210208143231109](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143231109.png)

参数详情如下：

| 参数项       | 参数详情                                                     |
| ------------ | ------------------------------------------------------------ |
| 设备操作权限 | **发布：**用于设备侧向平台上报消息的topic<br />**订阅：**用于平台向设备下发消息的topic |
| topic类      | 支持自定义topic名称                                          |
| 描述         | 关于该自定义topic的其他描述                                  |
| QoS          | 可选择该topic不同的MQTT QoS,其中<br />**QoS 0：**最多一次传输<br />**QoS 1：**最少一次传输<br />**QoS 2：**只有一次传输 |



##### 4.3.1.3 产品功能定义

产品功能包含属性、服务、事件，其相关定义如下。

| 产品功能 | 功能定义                                                     |
| -------- | ------------------------------------------------------------ |
| 属性     | 属性分为只读属性和读写属性，只读属性仅支持由设备侧更新上报给平台，读写属性支持由平台更新下发给设备侧。 |
| 服务     | 由平台向设备侧下发服务，设备执行服务后向平台回复服务执行信息 |
| 事件     | 和规则引擎等同时使用，用于设备侧向平台上报告警、故障、信息等事件信息 |

###### 创建产品属性定义

**操作步骤：**

1、访问 **设备管理 > 产品 > 产品详情** 。

2、点击 **功能定义** 按钮，点击 **属性** 子按钮。

3、点击 **创建属性**，填写必要属性定义信息。

4、单击 **确认** ，创建产品的属性定义。

![image-20210208143334058](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143334058.png)

创建属性参数详情如下：

| 参数项   | 参数详情                                                     |
| -------- | ------------------------------------------------------------ |
| 属性名称 | 属性的名称                                                   |
| 标识符   | 自定义属性标识符（即属性id）                                 |
| 数据类型 | 现支持的可选数据类型有：bool, int32, int64, float, double, text |
| 读写类型 | 支持读写和只读类型<br />**读写：**即设备侧可以向平台上报属性，平台也可以更新属性下发给设备侧。<br />**只读：**仅设备侧可以向平台上报属性。 |
| 描述     | 关于该属性的描述                                             |



###### 创建产品服务定义

**操作步骤：**

1、访问 **设备管理 > 产品 > 产品详情** 。

2、点击 **功能定义** 按钮，点击 **服务** 子按钮。

3、点击 **创建服务**，填写必要服务定义信息。

4、单击 **确认** ，创建产品的服务定义。

![image-20210208143403980](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143403980.png)

创建服务参数详情如下：

| 参数项   | 参数详情                                                     |
| -------- | ------------------------------------------------------------ |
| 服务名称 | 服务的名称                                                   |
| 标识符   | 自定义服务标识符（即服务id）                                 |
| 输入参数 | 可添加多个服务输入参数，即平台下发给设备侧的服务相关参数<br />可选，设置该服务的输入参数。用户通过自定义（可以使用已配置属性作为输入参数）配置，如定义转速属性作为输入参数，调用该服务时传入该参数，设备按照设定参数作为转速运转 |
| 输出参数 | 可添加多个服务输出参数，即设备侧执行完服务后回复给平台的参数<br />可选，设置该服务的输出参数。用户通过自定义（可以使用已配置属性作为输出参数）配置，如定义当前电压值属性作为输出参数，调用该服务时设备返回当前电压值属性给平台。 |
| 描述     | 关于该服务的描述                                             |



######  创建产品事件定义

**操作步骤：**

1、访问 **设备管理 > 产品 > 产品详情** 。

2、点击 **功能定义** 按钮，点击 **事件** 子按钮。

3、点击 **创建事件**，填写必要事件定义信息。

4、单击 **事件** ，创建产品的事件定义。

![image-20210208143538221](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143538221.png)

创建事件参数详情如下：

| 参数项   | 参数详情                                                     |
| -------- | ------------------------------------------------------------ |
| 事件名称 | 事件的名称                                                   |
| 标识符   | 自定义事件标识符（即事件id）                                 |
| 事件类型 | 可选择类型：信息、告警、故障                                 |
| 输出参数 | 可添加多个事件输出参数，即事件发生时设备侧发送给平台的信息<br />可选，设置该事件的输出参数。用户通过自定义（可以使用已配置属性作为输出参数）配置，如定义电压值属性作为输出参数，当设备上报故障时，则设备发送当前电压值给平台作为输出参数。 |
| 描述     | 关于该服务的描述                                             |



##### 4.3.1.4 发布产品 TBD +分享功能

产品开发配置完成后，可以对产品进行发布。

**操作步骤：**

1、访问**设备管理 > 产品 > 产品详情**。

2、单击 **发布** 按钮，确认相关信息。

3、单击 **发布** ，发布产品。



#### 4.3.2 设备

设备指某个产品下的设备实体，设备通常包括直连设备、网关和网关子设备。展湾智慧通®工业物联网平台支持单个、批量添加设备，您可以添加接入您的实体设备，实现设备与物联网平台的交互通信。

作为产品的实体，该产品下的设备自动继承该产品定义的Topic类和功能。 设备的相关信息、分组关联、租户与设备的关联存储在MySQL数据库。事件、服务、属性上报与变更存储在Redis和IoTDB中。

展湾智慧通®工业物联网平台支持对设备添加地理信息，方便用户在总体概览中按地图查看设备分布，并对设备按地理信息进行筛选等。



##### 4.3.2.1 添加设备

设备指归属于某一产品下的设备物理实体。展湾智慧通®工业物联网平台支持对某一产品逐个及批量添加设备。

###### 单个添加设备                                             

**操作步骤：**

1、访问 **设备管理 > 设备** ，点击 **添加设备**。

2、选择产品，填写设备名称和描述，选择设备的地理位置。

3、单击**确认**，添加该产品下的一个设备。

![image-20210208143657112](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143657112.png)



###### 批量添加设备

**操作步骤：**

1、访问 **设备管理 > 设备** ，点击 **批量添加**。

2、**自动生成：** 选择产品，选择设备的地理位置，添加方式选择自动生成，填写要添加的设备数量；

​      **批量上传：** 选择产品，选择设备的地理位置，添加方式选择批量上传，点击 **上传文件** 上传.csv模板文件（.CSV模板格式可以从页面下载）；

3、单击**确认**，为该产品批量添加设备。

![image-20210208143726775](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143726775.png)

设备添加成功后，可点击 **查看** 操作查看设备详情。设备详情页包含所属产品名、产品标识符、设备密码等基本信息，其中，点击 **查看** 设备密码，即可查看平台自动生产的唯一的设备标识符和设备密码。您也可以查看设备信息、Topic类列表、物模型数据、设备影子等相关信息。

![image-20210208143848370](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143848370.png)



##### 4.3.2.2 设备Topic类

访问 **设备管理 > 设备 > 设备详情** ，选择 **Topic类列表** ，即可查看设备Topic类列表（包含基础通信Topic、物模型Topic、自定义Topic）。设备继承该产品的所有Topic类。



##### 4.3.2.3 物模型数据

访问 **设备管理 > 设备 > 设备详情** ，选择 **物模型数据** ，即可查看设备运行状态、事件管理、服务调用等相关数据与记录。

![image-20210208143956900](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208143956900.png)



##### 4.3.2.4 设备影子

展湾智慧通®工业物联网平台提供设备影子功能，每个设备有且只有一个设备影子，用来缓存设备状态和应用程序期望状态信息。设备影子是一个JSON文件，设备可以通过获取和设置设备影子来同步设备属性值。设备影子分为desired值和report值：

**desired：**用于存储对设备属性的期望值，即配置值。当需要修改属性的配置值时，可于平台修改设备影子的desired值，设备在线时，desired值就会立即同步到设备；设备离线时，desired值会在设备上线时同步到设备。**report：**用于存储设备最新上报的属性值，设备上报数据时，平台会自动更新设备影子的report值 。

访问 **设备管理 > 设备 > 设备详情** ，选择 **设备影子** ，即可查看设备影子。可点击 **更新影子** ，填写设备期待值更新desired值。

![image-20210208144019128](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208144019128.png)



#### 4.3.3 设备分组

展湾智慧通®工业物联网平台提供设备分组功能，实现多场景下的跨产品设备管理。访问 **设备管理 > 设备分组** 页面，用户可以查看与查询设备本组信息，并可以新建和管理设备分组。设备分组不限层级，父分组下可建立多个、多层子分组。

![image-20210208144133272](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208144133272.png)



#### 4.3.4 协议管理

展湾智慧通®工业物联网平台提供丰富协议的设备SDK，访问 **设备管理 > 协议管理** 页面，用户可以查看支持的协议名称与相应的驱动语言等信息，选择所需协议的SDK点击 **下载** 操作下载SDK、说明文档及设备证书压缩包。

![image-20210208144255128](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208144255128.png)

---



### 4.4 规则引擎

规则引擎是指用户可以对接入平台的产品或设备设定相应的数据流动和计算规则，在条件满足所设定的规则后，平台会触发相应的数据转发等动作来满足用户需求。规则引擎主要进行消息服务器的共享订阅、数据分流处理和过滤、统一字段名称、解析协议等数据处理工作。展湾智慧通®工业物联网平台的规则引擎功能基于flink组件，用户可通过创建规则和编写SQL语句对规则进行配置。

---

#### 4.4.1 数据流转 

数据流转类型的规则可以对设备上报的数据进行简单处理，并将处理后的数据流转到其他Topic，支持JSON和二进制数据格式。 规则引擎可对数据进行计算，数据流转目的地可以为：Redis、MySQL、IoTDB、influxDB、MQTT等。

##### 4.4.1.1 创建数据流转规则

**操作步骤：**

1、访问 **规则引擎 > 数据流转** ，可以查看已创建的规则列表。

2、点击 **创建规则**，填写规则名称、描述等，选择数据格式（当前支持JSON）。

3、点击**创建**，创建一个数据流转规则。

![image-20210208144337879](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208144337879.png)



##### 4.1.1.2 规则配置

规则创建完成后，需要对规则进行配置和启用。用户可按照规则详情配置页面的界面操作指导，编写Flink SQL语句和选择相关参数，对规则进行配置。

**操作步骤：**

1、访问 **规则引擎 > 数据流转** ，可以查看已创建的规则列表。

2、点击 **查看** 操作进入待配置的规则的详情页面。

3、对处理数据、窗口计算、转发数据、转发错误数据等规则参数进行配置。

4、规则详情配置完成后，返回 **数据流转** 列表页面。可以点击 **启动** 操作启动配置完成的数据流转规则。

| 参数名称     | 参数说明                                                     |
| ------------ | ------------------------------------------------------------ |
| 处理数据     | 待计算、待流转的数据，此处需根据页面提醒编写SQL语句进行规则查询。<br />当前支持的topic类型有物模型属性上报、物模型事件上报。 |
| 窗口计算     | 对流转数据进行计算。当前支持的聚合函数有：求和、最小值、最大值、平均值。支持的窗口类型有：固定窗口、滑动窗口、会话窗口、OVER窗口。 |
| 转发数据     | 配置成功消息转发的目的地，需提供IP地址、端口号、账号密码、数据库名、表名、键、值等。当前支持数据转发落入的目的地有：云数据库（MySQL, IoTDB, Redis, InfluxDB）和MQTT。 |
| 转发错误数据 | 配置转发错误数据目的地，可以将正常操作中因实例或配置问题流转失败的数据再次流转给用户。需提供IP地址、端口号、账号密码、数据库名、表名、键、值等。当前支持错误数据流转的目的地有：云数据库Redis和MQTT。 |





---



### 4.5 监控运维

展湾智慧通®工业物联网平台提供运维监控功能，包含可视化组态（2D/3D）、在线调试、远程配置、固件升级、日志查看等功能模块，实现平台对海量接入设备及工业大数据高效、全面、多维度、易操作、高可视化的实时运维监控。

#### 4.5.1 可视化组态

展湾智慧通®工业物联网平台提供管控一体化的组态功能，无需专业程序员参与，可随需而变，通过图形化2D/3D组态，实现数据模型与2D/3D图形模型完美对接，简单配置将现场过程数据引入到生产管理系统中，全面实现采集和监控软件数据对接。

![运维监控-3D查看页](C:\Users\yujue.wang\Downloads\宙斯UI-07-15\3D\运维监控-3D查看页.png)

##### 4.5.1.1 2D组态

**操作步骤：**

1、访问 **运维监控 > 2D组态** ，可查看已经制作完成的2D组态列表。

2、点击 **新建** ，填写模型名称与描述，也可以 **点击选择组态模型** 上传2D组态模型。

3、点击 **保存**，创建2D组态模型。

![image-20210208144911929](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208144911929.png)



4、可通过拖拉拽进行基础组件的修改、组合与绘制等，点击 **保存** 保存修改。

![image-20210208145025771](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208145025771.png)



5、选中text组件，点击 **配置数据源** 可绑定物模型属性数据参数，点击 **保存** 保存配置。

![image-20210208145214630](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208145214630.png)



6、选择组件，点击**交互**，可以添加交互，交互是由**事件**引发，满足预设的一或多个**条件**后引发一系列**动作**。



保存2D模型配置后，可以再2D组态列表上点击 **导出模型** 导出配置好的2D模型；也可以点击 **分享** 生成分享链接。

![image-20210208161028331](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208161028331.png)



##### 4.5.1.2 3D组态

展湾智慧通®工业物联网平台3D组态功能支持相关3D模型的导入、编辑、删除、查看操作。3D模型导入后，可以通过编辑在需要绑定数据的地方添加数据锚点，向导入3D模型上捆绑平台数据，易于实时展示。

###### 导入3D模型

**操作步骤：**

1、访问 **运维监控 > 3D组态** ，可查看已经制作完成的3D组态列表。

2、点击 **导入模型** ，填写模型名称与描述， **点击选择模型** 上传3D组态模型（现支持.obj、.glb、.gltf格式）。

3、点击 **上传**，导入3D组态模型。

![image-20210208163534055](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208163534055.png)



###### 增加数据锚点

**操作步骤：**

1、访问 **运维监控 > 3D组态** ，可查看已经制作完成的3D组态列表。

2、对需要增加数据联动的模型点击 **配置** 操作，填写模型名称，选择产品、设备及属性。

3、点击 **确定**，增加数据锚点。

![image-20200828114437120](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200828114437120.png)

5、配置完3D模型配置后，可以进行查看。

![image-20200828114704315](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200828114704315.png)

保存3D模型配置后，可以再3D组态列表上点击 **导出模型** 导出配置好的3D模型；也可以点击 **分享** 生成分享链接。



#### 4.5.2 在线调试

展湾智慧通®工业物联网平台提供真实设备与虚拟设备的在线调试功能。真实/虚拟调试功能包含属性调试与服务调试。

**调试虚拟设备：**设备开发完成前，用户可以创建虚拟设备接入物联网平台，上报模拟属性和事件数据，虚拟设备可以模拟真实设备在云端建立连接、上报属性、时间处理等，方便用户进行虚拟调试，从而不依赖真实设备，快速完成应用的开发调试。

**调试真实设备：**设备开发完成后，用户可以使用在线调试功能，对相应的产品和设备下发调试指令进行功能调试。

##### 4.5.2.1 调试真实设备

设备端开发完成后，用户可以通过在线调试功能，从平台下发调试指令给设备进行功能调试（支持属性调试、服务调用）。下发指令后，用户可通过界面上的实时日志查看真实设备的响应结果。

1、**运维监控 > 在线调试** 页面中选择需要调试的真实设备。

2、选择 **调试真实设备**，可以选择对该设备的 **属性** 或 **服务** 进行调试 。

3、选择测试功能与方法（见下表），编写调试指令。

4、针对具体的功能编写完指令后，点击 **发送指令** 按钮将指令下发到真实设备。

5、可通过界面右侧的 **实时日志** 查看真实设备的响应结果。

![image-20210208164939510](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208164939510.png)

在线调试功能与方法：

| 调试功能 | 方法 | 描述                                                         |
| -------- | ---- | ------------------------------------------------------------ |
| 属性     | 获取 | 获取设备属性的值。                                           |
| 属性     | 设置 | 对于“读写”权限的设备属性，平台可以设置该设备属性值。<br />平台下发设置指令给设备，设备收到指令后设置属性值，并回复最新属性值给平台。 |
| 服务     | 调用 | 调用设备的服务。                                             |



##### 4.5.2.2 调试虚拟设备

展湾智慧通®工业物联网平台支持用户创建虚拟设备并进行虚拟设备在线调试（支持属性调试、服务调用），方便用户不依赖真实设备快速完成应用开发。

1、**运维监控 > 在线调试** 页面中选择需要调试的虚拟设备。

2、选择 **调试虚拟设备** 。

3、选择测试功能与方法（方法类似调试真实设备），编写调试指令。

4、针对具体的功能编写完指令后，点击 发送指令 按钮将指令下发到虚拟设备。

4、针对具体的功能编写完指令后，点击 **发送指令** 按钮将指令下发到虚拟设备。

5、可通过界面上的实时日志查看虚拟设备的响应结果。

![image-20210208165808700](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208165808700.png)



#### 4.5.3 远程配置

展湾智慧通®工业物联网平台支持从平台端向产品及设备远程批量下发配置场景。

**操作步骤：**

1、访问 **运维监控 > 远程配置** 。

2、选择待配置的产品，点击编辑。

3、输入配置模板，点击 **保存**。

4、点击 **批量更新**，确认无误后点击 **确认更新**，对该产品下所有设备自动更新配置文件。

![image-20210208165853884](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208165853884.png)



在 **运维监控 > 远程配置** 页面也提供配置版本更新记录，方便用户查看和进行版本恢复。点击 **查看** 查看版本详情，点击 **恢复至此版本** 可以恢复至该版本。

![image-20210208165922416](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208165922416.png)



#### 4.5.4 固件升级

固件升级（Over-the-Air Technology）对支持 OTA 功能的设备，可以在控制台上传新的固件，并将固件升级消息推送给设备，设备即可在线升级。

##### 4.5.4.1 新增固件

您可以通过平台控制台上传待升级的固件。

1、访问 **运维监控 > 固件升级** ，点击 **新增固件**。

2、选择产品，填写固件名称、版本号、签名算法（当前支持MD5）和固件描述等，点击上传固件。

3、单击**确认**，为该产品添加固件。

![image-20210208170356008](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208170356008.png)



##### 4.5.4.2 固件升级

上传固件后，您可以对该产品所有设备进行批量固件升级，或者选择单个设备进行固件升级。

###### 批量升级

访问 **运维监控 > 固件升级** ，查看现有固件列表，在待升级的固件操作栏中点击 **批量升级** ，完成对该产品所有设备的批量固件升级。

![image-20210208170751907](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208170751907.png)



###### 单个升级

**单个升级步骤：**

1、访问 **运维监控 > 固件升级** ，查看现有固件列表。

2、在待升级的固件操作栏中点击 **查看** ，查看固件详情。

3、点击 **设备列表**，对要升级的设备点击 **升级** 操作。

4、完成单个设备的固件升级。

![image-20210208170736285](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208170736285.png)



#### 4.5.5 日志查看

用户可通过日志查看服务查看各边缘端设备本地日志、系统运行日志、用户操作日志。当某项功能发生异常时，用户可以根据日志的记录信息搜索定位故障信息并及时诊断处理。

**操作步骤：**

1、访问 **运维监控 > 日志查看** ，查看日志。

2、选择产品，可以选择设备本地日志、系统运行日志、用户操作日志进行查看。

3、可以按照实际断、关键词、设备名等项对日志进行搜索筛选。

![image-20210208170943884](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208170943884.png)



##### 4.5.5.1 设备本地日志

边缘侧定期（15min）向平台端发送这段时间各种等级的设备本地日志数据，日志的等级定义如下：

| 日志等级 |      等级定义      |
| :------: | :----------------: |
|   OFF    |    关闭日志功能    |
|  TRACE   |        跟踪        |
|  DEBUG   |        调试        |
|   INFO   |      正常信息      |
|   WARN   |     警告，一般     |
|  ERROR   |     错误，严重     |
|  FATAL   | 致命错误，非常严重 |

等优先级从低到高分别是：**OFF < TRACE < DEBUG < INFO < WARN < 0ERROR< FATAL 

##### 4.5.5.2 系统运行日志

系统日志可以按照功能分类进行日志筛选。支持的功能分类有：OTA升级、NTP时间同步、远程配置、物模型、物影子、消息推送。



#### 4.5.6 远程维护

展湾智慧通®工业物联网平台提供远程维护功能，对设备属性等状态进行远程查看。用户可以通过产品对设备进行筛选，也可以对设备名称进行搜索。点击设备右上角图表，可以对设备查看该设备状态变更的历史图表。

![image-20210208171043781](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171043781.png)

---



### 4.6 消息推送

**订阅：**应用服务端可通过配置订阅，直接从物联网平台北向获取发生变化的设备业务信息（如：设备上报消息、设备状态变化通知、网关发现子设备上报、设备生命周期变更、设备拓扑关系变更等）。

**推送：**订阅成功后，物联网平台会直接把已订阅类型的消息推送至服务端。

当前，物联网平台支持基于HTTP(s)及MQTT协议的消息订阅推送服务。

#### 4.6.1 HTTP(s)消息推送

![image-20200715133125497](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200715133125497.png)

HTTP(s)订阅推送，消息默认以JSON格式采用HTTP POST的方式推送到租户配置的，可访达的URL地址。

**创建HTTP(s)推送步骤：**

1、 访问 **消息推送 > HTTP(s)消息推送**，查看HTTP消息推送列表。

2、 点击 **创建推送** 按钮，输入相关参数完成配置。

3、 完成配置后，点击 **确认**，完成HTTP订阅推送的创建。

![image-20210208171107442](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171107442.png)

创建HTTP推送参数详情如下：

| 参数项         | 参数详情                                                     |
| -------------- | :----------------------------------------------------------- |
| 推送名称       | 推送的名称，便于用户区分不同的消息推送                       |
| 产品           | 选择消息推送所订阅的产品                                     |
| 设备           | 选择推送消息所订阅的设备，支持多选                           |
| 推送地址       | HTTP(s)消息推送的地址，为可访达的URL                         |
| 重试策略       | 当前支持退避重试                                             |
| 推送消息的类型 | 选择订阅的推送消息类型，当所选择的设备业务信息发生变化时，即推送消息到目标地址，支持多选。当前支持的推送消息类型有：设备上报事件、设备上下线通知、设备拓扑关系变更、设备状态变化通知、设备生命周期变更、设备命令响应。 |



#### 4.6.2 MQTT消息推送

![image-20200715133050780](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200715133050780.png)

MQTT消息推送采用北向应用主动订阅的方式进行消息的流转，访问 **消息推送 > MQTT消息推送** ，可查看MQTT服务器地址、用户名及密码，用户可以从北向应用对消息推送的MQTT topic进行订阅（subscribe）。

**创建MQTT推送步骤：**

1、 访问 **消息推送 > MQTT消息推送**，查看MQTT消息推送列表。

2、 点击 **创建推送** 按钮，输入相关参数完成配置。

3、 完成配置后，点击 **确认**，完成MQTT订阅推送的创建。

![image-20210208171135121](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171135121.png)

创建HTTP推送参数详情如下：

| 参数项         | 参数详情                                                     |
| -------------- | :----------------------------------------------------------- |
| 推送名称       | 推送的名称，便于用户区分不同的消息推送                       |
| QoS            | 可选择该topic不同的MQTT QoS,其中<br />**QoS 0：**最多一次传输<br />**QoS 1：**最少一次传输<br />**QoS 2：**只有一次传输 |
| 产品           | 选择消息推送所订阅的产品                                     |
| 设备           | 选择推送消息所订阅的设备，支持多选                           |
| 推送消息的类型 | 选择订阅的推送消息类型，当所选择的设备业务信息发生变化时，即推送消息到目标地址，支持多选。当前支持的推送消息类型有：设备上报事件、设备上下线通知、设备拓扑关系变更、设备状态变化通知、设备生命周期变更、设备命令响应。 |



---



### 4.7 视频服务

展湾智慧通®工业物联网平台提供视频服务赋能工业现场视频监控。用户可通过视频服务配置连接摄像头、NVR/DVR设备上云，可以通过web界面进行视频直播及视频点播。

**直播：** 用户可以通过界面选择 **摄像头** 进行视频查看、直播；用户可以对直播流进行重命名。

**回放：** 用户可以通过界面浏览已存储的历史视频，并根据 **摄像头**、**开始时间**、**结束时间** 选择视频进行回放。

**分享：**支持对视频直播源和存储视频文件的分享操作，提供视频分享URL。



#### 4.7.1 视频源接入

当前，平台仅支持RTSP协议的视频源的接入,对接视频源的流程如下：

1、 通过 **视频服务 > 视频访问** 配置可以访问到的已有公网地址的边缘视频源RTSP地址(主码流和辅码流)；

2、 支持两种视频上云的方式：

① 摄像头做为服务器，公网云上的程序主动去拉取RTSP格式的视频流。一般大华或者海康的网络摄像头都提供RTSP协议。需要摄像头能直接从公网被访问读取，如果客户资源那边无法申请到公网ip会无法实施组网；

视频源具有主动向平台推流的能力（如NVR/DVR），可以通过配置视频源推流上云地址的方式实现视频流上云。

3、 在摄像头上云后，服务器提供RTSP转发功能，转发的格式依旧为RTSP，RTSP视频源的编码格式为H.264；

**接入视频源步骤：**

1、 访问 **视频服务 > 视频源接入**，可查看已接入的视频源列表。

2、 点击 **新建** 按钮，输入相关参数完成配置。

3、 完成配置后，点击 **确认**，接入视频源。

![image-20210208171218528](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171218528.png)

创建视频源的参数详情如下：

| 参数项   | 参数详情                                                     |
| -------- | :----------------------------------------------------------- |
| 类型     | 视频源接入的类型，支持拉流与推流两种类型：<br />**拉流：**摄像头做为服务器，主动拉取RTSP格式的视频流。拉流类型需要摄像头能直接从公网被访问读取。<br />**推流：**视频源具有主动向平台推流的能力（如NVR/DVR），支持推流上云类型。 |
| 名称     | 视频源的名称，便于用户区分                                   |
| 直播频道 | 选择视频源接入的直播频道，当前提供8个直播频道                |
| 地址     | 视频源的地址                                                 |
| 描述     | 可选择输入视频源的描述信息                                   |



#### 4.7.2 视频直播

**操作步骤：**

1、 访问 **视频服务 > 视频直播**，即可开始观看视频直播。

2、 点击 **摄像头** 按钮，勾选期望观看直播的摄像头名称。当前支持四分屏播放。点击视频直播屏右下角全屏按钮可以全屏播放直播源。

3、 点击视频直播屏右上角的分享图标，可以生成分享直播视频的链接；

![image-20210208171237758](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171237758.png)



#### 4.7.3 视频回放 	

1、租户通过 **视频服务 > 视频回放** 服务菜单进入视频回放服务的查看操作界面；

2、 租户可以在界面按照 **摄像头**，**开始时间 - 结束时间** 筛选存储的视频片段；

3、 视频存储界面支持，已存视频的查看，删除，搜索，观看的基础使用方式；

4、点击 **观看** 操作，即可播放存储视频。

5、可选择存储视频片段，点击 **分享** 按钮生成分享链接。

![image-20200828142042467](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200828142042467.png)



#### 4.7.4 设备访问

支持配置NVR/DVR等视频源的设备管理页面，访问 **视频服务 > 设备访问** 可以查看已配置的设备管理页面，点击后新窗口将跳转相应设备管理页面。点击 **设备配置**，添加新的设备管理页面。

![image-20210208171342495](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171342495.png)

---



### 4.8 BI服务

展湾智慧通®工业物联网平台商务智能（Business Intelligence）服务，是支持多种数据源接入、可视化组件丰富、可交互操作的企业级BI报表系统。用户可接入多种数据源数据，对大数据进行钻取切片等多维分析，帮助企业深挖理解数据、创造价值。用户可通过拖拽方式，简单高效组合多种图标形成仪表盘（Dashboard），将数据可视化并分发至企业各层级多种显示终端，帮助用户理解数据，助力企业智能化增长。

访问 **BI** ，跳转BI页面。

![image-20200717164724765](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200717164724765.png)

---



### 4.9 用户权限

用户权限提供平台用户管理和用户权限管理的功能。

#### 4.9.1 用户管理

通过 **用户权限 > 用户管理** 页面可以新建、编辑、删除平台用户账号信息。

**操作步骤：**

1、访问 **用户权限 > 用户管理** ,可以查看用户信息列表。

2、点击 **新建**，填写用户相关信息，选择用户角色。用户角色可以通过 **用户权限 > 权限管理** 进行查看与配置。

3、点击 **确认** ，新建用户。

4、可以勾选用户进行编辑、删除操作。

![image-20210208171748613](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208171748613.png)

#### 4.9.2 权限管理

用户角色及权限可以通过 **用户权限 > 权限管理** 部分进行角色创建和权限管理。可以通过勾选允许操作配置不同用户角色的权限。

**操作步骤：**

1、访问 **用户权限 > 权限管理** ，横向滑动栏显示用户角色。

2、点击某一用户角色，显示该用户角色的用户列表。如，点击管理员，显示身份为管理员的用户列表。

3、点击 **用户权限** ，可以查看当前角色的页面权限。

4、可以通过勾选不同页面的 **允许操作**，进行角色权限编辑。

5、点击加号头像框，新建用户角色

![image-20210208172012021](C:%5CUsers%5Cyujue.wang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210208172012021.png)

---



### 6 参考

#### 6.1 API参考

#### 6.2 SDK参考

工业物联网平台提供设备边缘SDK和应用SDK。设备通过边缘SDK接入到平台，应用通过调用工业物联网平台的API，**TBD实现安全接入、设备管理、数据采集、命令下发等业务场景。

##### 6.2.1 边缘SDK

![image-20200715162143797](C:\Users\yujue.wang\AppData\Roaming\Typora\typora-user-images\image-20200715162143797.png)

对下SDK使用的流程如下：

1、 边缘侧使用提供的对设备部分的SDK进行相应协议部分的采集；

2、 使用SDK时，需要提前在边缘上激活相应的协议，SDK同时只针对一个协议进行相应的采集调用；

3、 数据采集上来之后，使用提供的边缘侧上云SDK进行数据的上云操作，对接物模型等概念，进行云上业务的流转；

4、 支持Modbus、OPC、PPI等多种工业协议；

对下SDK的支持版本有，MQTT, CoAP, HTTPS, WebSocket协议的C++, Java, Python版本类型

##### 6.2.2 应用SDK

